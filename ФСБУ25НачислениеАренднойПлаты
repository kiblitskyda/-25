
Процедура КнопкаВыполнитьНажатие(Кнопка)
	
	КоличествоДокументов = СписокДокументов.Строки.Количество();
	
	Если КоличествоДокументов = 0 Тогда
		Предупреждение("Не отобраны данные для создания документов");
		Возврат;
	КонецЕсли;	
	
	СуммаПоДокументам = СписокДокументов.Строки.Итог("Всего");
	
	ТекстВопроса = СтрШаблон("Будет создано %1 документов на сумму %2 руб." + Символы.ПС + "Продолжить?", КоличествоДокументов, СуммаПоДокументам);  
	Если Вопрос(ТекстВопроса, РежимДиалогаВопрос.ДаНет) = КодВозвратаДиалога.Нет Тогда
		Возврат;
	КонецЕсли;
	
	
	Для каждого Строка Из СписокДокументов.Строки Цикл
		
		НовыйДок = Документы.ПоступлениеТоваровУслуг.ПустаяСсылка();
		ЭлементыФормы.СписокДокументов.ТекущаяСтрока = Строка;
		
		Попытка
			Если ВидНачисления = "Арендная плата" Тогда
				НовыйДок = СоздатьДокументПТУПоАренднойПлате(Строка);
			ИначеЕсли ВидНачисления = "Проценты" Тогда
				НовыйДок = СоздатьДокументПТУПоПроцентам(Строка);
			КонецЕсли;
			Строка.Сообщение = "Создан";
		Исключение
			ТекстСообщения = СтрШаблон("Ошибка создания документа: строка №%1 от %2, %3, %4." + ОписаниеОшибки(), 
			Строка.Номер, 
			Строка.ДатаДокумента, 
			Строка.Контрагент, 
			Строка.Договор);
			Строка.Сообщение = ТекстСообщения;												
			Сообщить(ТекстСообщения);
		КонецПопытки;		
		Строка.НовыйДокумент = НовыйДок.Ссылка;
		ЭтаФорма.Обновить();
	КонецЦикла;
	
	Предупреждение("Завершено");
	
КонецПроцедуры

Процедура ОтобратьНажатие()
	
	СписокДокументов.Строки.Очистить();
	ВидНачисления = "Арендная плата";
	Запрос = Новый Запрос;
	Запрос.Текст = 
		"ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	_УчетДолгосрочнойАрендыОстатки.Договор,
		|	_УчетДолгосрочнойАрендыОстатки.ОбъектППА,
		|	_УчетДолгосрочнойАрендыОстатки.Регистратор КАК График,
		|	_УчетДолгосрочнойАрендыОстатки.Регистратор.Дата КАК Дата
		|ПОМЕСТИТЬ ВТ_СписокППА
		|ИЗ
		|	РегистрСведений._УчетДолгосрочнойАренды КАК _УчетДолгосрочнойАрендыОстатки
		|ГДЕ
		|	_УчетДолгосрочнойАрендыОстатки.Период <= КОНЕЦПЕРИОДА(&СостояниеГрафиковНаДату, ДЕНЬ)
		|	И НЕ(_УчетДолгосрочнойАрендыОстатки.ВидДвиженияГрафика = ЗНАЧЕНИЕ(Перечисление._ВидыДвиженийГрафиковДолгосрочнойАренды.Выбытие)
		|				И _УчетДолгосрочнойАрендыОстатки.ДатаСобытия > _УчетДолгосрочнойАрендыОстатки.ПериодГрафика)
		|	И _УчетДолгосрочнойАрендыОстатки.Регистратор.ЗаменаСтороныДоговора = ЛОЖЬ
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	_УчетДолгосрочнойАрендыОстатки.Договор,
		|	_УчетДолгосрочнойАрендыОстатки.ОбъектППА,
		|	_УчетДолгосрочнойАрендыОстатки.ПериодГрафика КАК Период,
		|	СУММА(ВЫБОР
		|			КОГДА _УчетДолгосрочнойАрендыОстатки.Показатель = ЗНАЧЕНИЕ(Перечисление._ПоказателиГрафиковДолгосрочнойАренды.АрендныеПлатежи)
		|				ТОГДА -_УчетДолгосрочнойАрендыОстатки.Обязательство
		|			ИНАЧЕ 0
		|		КОНЕЦ) КАК АренднаяПлата,
		|	СУММА(ВЫБОР
		|			КОГДА _УчетДолгосрочнойАрендыОстатки.Показатель = ЗНАЧЕНИЕ(Перечисление._ПоказателиГрафиковДолгосрочнойАренды.Проценты)
		|				ТОГДА _УчетДолгосрочнойАрендыОстатки.Обязательство
		|			ИНАЧЕ 0
		|		КОНЕЦ) КАК Проценты,
		|	СУММА(ВЫБОР
		|			КОГДА _УчетДолгосрочнойАрендыОстатки.Показатель = ЗНАЧЕНИЕ(Перечисление._ПоказателиГрафиковДолгосрочнойАренды.АрендныеПлатежи)
		|				ТОГДА -_УчетДолгосрочнойАрендыОстатки.НДС
		|			ИНАЧЕ 0
		|		КОНЕЦ) КАК НДС
		|ПОМЕСТИТЬ ВТ_Данные
		|ИЗ
		|	РегистрСведений._УчетДолгосрочнойАренды КАК _УчетДолгосрочнойАрендыОстатки
		|ГДЕ
		|	_УчетДолгосрочнойАрендыОстатки.Период <= КОНЕЦПЕРИОДА(&СостояниеГрафиковНаДату, ДЕНЬ)
		|	И _УчетДолгосрочнойАрендыОстатки.ПериодГрафика МЕЖДУ НАЧАЛОПЕРИОДА(&НачалоПериода, ДЕНЬ) И КОНЕЦПЕРИОДА(&КонецПериода, ДЕНЬ)
		|	И НЕ(_УчетДолгосрочнойАрендыОстатки.ВидДвиженияГрафика = ЗНАЧЕНИЕ(Перечисление._ВидыДвиженийГрафиковДолгосрочнойАренды.Выбытие)
		|				И _УчетДолгосрочнойАрендыОстатки.ДатаСобытия > _УчетДолгосрочнойАрендыОстатки.ПериодГрафика)
		|	И ВЫБОР
		|			КОГДА &Контрагент = ЗНАЧЕНИЕ(Справочник.Контрагенты.ПустаяСсылка)
		|				ТОГДА ИСТИНА
		|			ИНАЧЕ ВЫБОР
		|					КОГДА &КонтрагентИсключить = ИСТИНА
		|						ТОГДА НЕ _УчетДолгосрочнойАрендыОстатки.Договор.Владелец = &Контрагент
		|					ИНАЧЕ _УчетДолгосрочнойАрендыОстатки.Договор.Владелец = &Контрагент
		|				КОНЕЦ
		|		КОНЕЦ
		|	И ВЫБОР
		|			КОГДА &Договор = ЗНАЧЕНИЕ(справочник.ДоговорыКонтрагентов.ПустаяСсылка)
		|				ТОГДА ИСТИНА
		|			ИНАЧЕ ВЫБОР
		|					КОГДА &ДоговорИсключить = ИСТИНА
		|						ТОГДА НЕ _УчетДолгосрочнойАрендыОстатки.Договор = &Договор
		|					ИНАЧЕ _УчетДолгосрочнойАрендыОстатки.Договор = &Договор
		|				КОНЕЦ
		|		КОНЕЦ
		|	И ВЫБОР
		|			КОГДА &ОбъектППА = ЗНАЧЕНИЕ(справочник.ОсновныеСредства.ПустаяСсылка)
		|				ТОГДА ИСТИНА
		|			ИНАЧЕ ВЫБОР
		|					КОГДА &ОбъектППАИсключить = ИСТИНА
		|						ТОГДА НЕ _УчетДолгосрочнойАрендыОстатки.ОбъектППА = &ОбъектППА
		|					ИНАЧЕ _УчетДолгосрочнойАрендыОстатки.ОбъектППА = &ОбъектППА
		|				КОНЕЦ
		|		КОНЕЦ
		|
		|СГРУППИРОВАТЬ ПО
		|	_УчетДолгосрочнойАрендыОстатки.ОбъектППА,
		|	_УчетДолгосрочнойАрендыОстатки.ПериодГрафика,
		|	_УчетДолгосрочнойАрендыОстатки.Договор
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ВТ_Данные.Договор,
		|	ВТ_Данные.ОбъектППА,
		|	ВТ_Данные.Период,
		|	ОКР(ВТ_Данные.АренднаяПлата, 2) КАК АренднаяПлата,
		|	ОКР(ВТ_Данные.НДС, 2) КАК НДС,
		|	ОКР(ВТ_Данные.Проценты, 2) КАК Проценты
		|ПОМЕСТИТЬ ВТ_Начисления
		|ИЗ
		|	ВТ_Данные КАК ВТ_Данные
		|ГДЕ
		|	Выбор когда &ВидНачисления = ""Арендная плата"" тогда ОКР(ВТ_Данные.АренднаяПлата, 2) <> 0 
		|			когда &ВидНачисления = ""Проценты"" тогда ОКР(ВТ_Данные.Проценты, 2) <> 0 Конец
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	Начисления.Договор,
		|	Начисления.Договор.Владелец КАК Контрагент,
		|	Начисления.ОбъектППА,
		|	Начисления.АренднаяПлата КАК Сумма,
		|	Начисления.НДС,
		|	СписокППА.График,
		|	СписокППА.График.ОтдельныеАктыПоАдресам КАК ОтдельныеАктыПоАдресам,
		|	СписокППА.Дата
		|ПОМЕСТИТЬ ВТ_Начисления2
		|ИЗ
		|	ВТ_Начисления КАК Начисления
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_СписокППА КАК СписокППА
		|		ПО ((СписокППА.Дата, СписокППА.ОбъектППА) В
		|				(ВЫБРАТЬ
		|					МАКСИМУМ(СписокППА.Дата),
		|					СписокППА.ОбъектППА
		|				ИЗ
		|					ВТ_СписокППА КАК СписокППА
		|				ГДЕ
		|					СписокППА.ОбъектППА = Начисления.ОбъектППА
		|				СГРУППИРОВАТЬ ПО
		|					СписокППА.ОбъектППА))
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ВТ_Начисления2.Договор,
		|	ВТ_Начисления2.Контрагент,
		|	ВТ_Начисления2.ОбъектППА,
		|	ВТ_Начисления2.Сумма,
		|	ВТ_Начисления2.НДС,
		|	ВТ_Начисления2.График,
		|	ВТ_Начисления2.ОтдельныеАктыПоАдресам,
		|	_ГрафикДоговораДолгосрочнойАрендыГрафикПоДоговору.СтавкаНДС
		|ПОМЕСТИТЬ ВТ_Начисления3
		|ИЗ
		|	ВТ_Начисления2 КАК ВТ_Начисления2
		|		ЛЕВОЕ СОЕДИНЕНИЕ Документ._ГрафикДоговораДолгосрочнойАренды.ГрафикПоДоговору КАК _ГрафикДоговораДолгосрочнойАрендыГрафикПоДоговору
		|		ПО ВТ_Начисления2.График = _ГрафикДоговораДолгосрочнойАрендыГрафикПоДоговору.Ссылка
		|			И (_ГрафикДоговораДолгосрочнойАрендыГрафикПоДоговору.ДатаПо В
		|				(ВЫБРАТЬ
		|					МАКСИМУМ(_ГрафикДоговораДолгосрочнойАрендыГрафикПоДоговору.ДатаПо)
		|				ИЗ
		|					Документ._ГрафикДоговораДолгосрочнойАренды.ГрафикПоДоговору КАК _ГрафикДоговораДолгосрочнойАрендыГрафикПоДоговору
		|				ГДЕ
		|					_ГрафикДоговораДолгосрочнойАрендыГрафикПоДоговору.Ссылка = ВТ_Начисления2.График
		|					И _ГрафикДоговораДолгосрочнойАрендыГрафикПоДоговору.ДатаПо <= &КонецПериода))
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ВТ_Начисления3.Договор,
		|	ВТ_Начисления3.Контрагент,
		|	ВТ_Начисления3.ОбъектППА,
		|	ВТ_Начисления3.Сумма,
		|	ВТ_Начисления3.НДС,
		|	ВТ_Начисления3.График,
		|	ВТ_Начисления3.ОтдельныеАктыПоАдресам,
		|	Выбор 
		|		когда ВТ_Начисления3.СтавкаНДС = Значение(Перечисление.СтавкиНДС.ПустаяСсылка) Тогда График.СтавкаНДС
		|		Иначе ВТ_Начисления3.СтавкаНДС
		|	Конец как СтавкаНДС
		|ИЗ
		|	ВТ_Начисления3 КАК ВТ_Начисления3
		|";   
		
	Если СостояниеГрафиковНаДату = Дата(1,1,1) Тогда
		мСостояниеГрафиковНаДату = Дата(2999,1,1)
	Иначе 
		мСостояниеГрафиковНаДату = СостояниеГрафиковНаДату 
	КонецЕсли;
		
	Запрос.Параметры.Вставить("СостояниеГрафиковНаДату", мСостояниеГрафиковНаДату); 
	Запрос.Параметры.Вставить("НачалоПериода", НачалоПериода); // <Дата>[01.12.2024 0:00:00]
	Запрос.Параметры.Вставить("КонецПериода", КонецПериода); // <Дата>[01.01.2025 0:00:00]
	Запрос.Параметры.Вставить("Договор", Договор); // <Договор контрагента>[], Справочники.ДоговорыКонтрагентов.ПустаяСсылка();
	Запрос.Параметры.Вставить("Контрагент", Контрагент); // <Контрагент>[КИО (бывший КУГИ)], Справочники.Контрагенты.НайтиПоНаименованию("КИО (бывший КУГИ)");
	Запрос.Параметры.Вставить("ОбъектППА", ОбъектППА); // <Основные средства>[], Справочники.ОсновныеСредства.ПустаяСсылка();
	Запрос.Параметры.Вставить("ДоговорИсключить", ДоговорИсключить); // <Булево>[Нет]
	Запрос.Параметры.Вставить("КонтрагентИсключить", КонтрагентИсключить); // <Булево>[Да]
	Запрос.Параметры.Вставить("ОбъектППАИсключить", ОбъектППАИсключить); // <Булево>[Нет]
	Запрос.Параметры.Вставить("ВидНачисления", ВидНачисления); 
	
	Список = Запрос.Выполнить().Выгрузить();
	
	Сгруппировать(Список);
	
	
КонецПроцедуры

Процедура ОбновлениеОтображения()
	
	Попытка
		ЭлементыФормы.СписокДокументов.Колонки["Номер"].ТекстПодвала = СписокДокументов.Строки.Количество();
		ЭлементыФормы.СписокДокументов.Колонки["Номер"].ГоризонтальноеПоложениеВПодвале = ГоризонтальноеПоложение.Право; 
	Исключение
		
	КонецПопытки;
	
	
КонецПроцедуры

Процедура ПроцентыНажатие(Элемент) 
	
	СписокДокументов.Строки.Очистить();
	ВидНачисления = "Проценты";
	
	Запрос = Новый Запрос;
		Запрос.Текст = 
	"ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	_УчетДолгосрочнойАрендыОстатки.Договор,
		|	_УчетДолгосрочнойАрендыОстатки.ОбъектППА,
		|	_УчетДолгосрочнойАрендыОстатки.Регистратор КАК График,
		|	_УчетДолгосрочнойАрендыОстатки.Регистратор.Дата КАК Дата
		|ПОМЕСТИТЬ ВТ_СписокППА
		|ИЗ
		|	РегистрСведений._УчетДолгосрочнойАренды КАК _УчетДолгосрочнойАрендыОстатки
		|ГДЕ
		|	_УчетДолгосрочнойАрендыОстатки.Период <= КОНЕЦПЕРИОДА(&СостояниеГрафиковНаДату, ДЕНЬ)
		|	И НЕ(_УчетДолгосрочнойАрендыОстатки.ВидДвиженияГрафика = ЗНАЧЕНИЕ(Перечисление._ВидыДвиженийГрафиковДолгосрочнойАренды.Выбытие)
		|				И _УчетДолгосрочнойАрендыОстатки.ДатаСобытия > _УчетДолгосрочнойАрендыОстатки.ПериодГрафика)
		|	И _УчетДолгосрочнойАрендыОстатки.Регистратор.ЗаменаСтороныДоговора = ЛОЖЬ
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	_УчетДолгосрочнойАрендыОстатки.Договор,
		|	_УчетДолгосрочнойАрендыОстатки.ОбъектППА,
		|	_УчетДолгосрочнойАрендыОстатки.ПериодГрафика КАК Период,
		|	СУММА(ВЫБОР
		|			КОГДА _УчетДолгосрочнойАрендыОстатки.Показатель = ЗНАЧЕНИЕ(Перечисление._ПоказателиГрафиковДолгосрочнойАренды.АрендныеПлатежи)
		|				ТОГДА -_УчетДолгосрочнойАрендыОстатки.Обязательство
		|			ИНАЧЕ 0
		|		КОНЕЦ) КАК АренднаяПлата,
		|	СУММА(ВЫБОР
		|			КОГДА _УчетДолгосрочнойАрендыОстатки.Показатель = ЗНАЧЕНИЕ(Перечисление._ПоказателиГрафиковДолгосрочнойАренды.Проценты)
		|				ТОГДА _УчетДолгосрочнойАрендыОстатки.Обязательство
		|			ИНАЧЕ 0
		|		КОНЕЦ) КАК Проценты,
		|	СУММА(ВЫБОР
		|			КОГДА _УчетДолгосрочнойАрендыОстатки.Показатель = ЗНАЧЕНИЕ(Перечисление._ПоказателиГрафиковДолгосрочнойАренды.АрендныеПлатежи)
		|				ТОГДА -_УчетДолгосрочнойАрендыОстатки.НДС
		|			ИНАЧЕ 0
		|		КОНЕЦ) КАК НДС
		|ПОМЕСТИТЬ ВТ_Данные
		|ИЗ
		|	РегистрСведений._УчетДолгосрочнойАренды КАК _УчетДолгосрочнойАрендыОстатки
		|ГДЕ
		|	_УчетДолгосрочнойАрендыОстатки.Период <= КОНЕЦПЕРИОДА(&СостояниеГрафиковНаДату, ДЕНЬ)
		|	И _УчетДолгосрочнойАрендыОстатки.ПериодГрафика МЕЖДУ НАЧАЛОПЕРИОДА(&НачалоПериода, ДЕНЬ) И КОНЕЦПЕРИОДА(&КонецПериода, ДЕНЬ)
		|	И НЕ(_УчетДолгосрочнойАрендыОстатки.ВидДвиженияГрафика = ЗНАЧЕНИЕ(Перечисление._ВидыДвиженийГрафиковДолгосрочнойАренды.Выбытие)
		|				И _УчетДолгосрочнойАрендыОстатки.ДатаСобытия > _УчетДолгосрочнойАрендыОстатки.ПериодГрафика)
		|	И ВЫБОР
		|			КОГДА &Контрагент = ЗНАЧЕНИЕ(Справочник.Контрагенты.ПустаяСсылка)
		|				ТОГДА ИСТИНА
		|			ИНАЧЕ ВЫБОР
		|					КОГДА &КонтрагентИсключить = ИСТИНА
		|						ТОГДА НЕ _УчетДолгосрочнойАрендыОстатки.Договор.Владелец = &Контрагент
		|					ИНАЧЕ _УчетДолгосрочнойАрендыОстатки.Договор.Владелец = &Контрагент
		|				КОНЕЦ
		|		КОНЕЦ
		|	И ВЫБОР
		|			КОГДА &Договор = ЗНАЧЕНИЕ(справочник.ДоговорыКонтрагентов.ПустаяСсылка)
		|				ТОГДА ИСТИНА
		|			ИНАЧЕ ВЫБОР
		|					КОГДА &ДоговорИсключить = ИСТИНА
		|						ТОГДА НЕ _УчетДолгосрочнойАрендыОстатки.Договор = &Договор
		|					ИНАЧЕ _УчетДолгосрочнойАрендыОстатки.Договор = &Договор
		|				КОНЕЦ
		|		КОНЕЦ
		|	И ВЫБОР
		|			КОГДА &ОбъектППА = ЗНАЧЕНИЕ(справочник.ОсновныеСредства.ПустаяСсылка)
		|				ТОГДА ИСТИНА
		|			ИНАЧЕ ВЫБОР
		|					КОГДА &ОбъектППАИсключить = ИСТИНА
		|						ТОГДА НЕ _УчетДолгосрочнойАрендыОстатки.ОбъектППА = &ОбъектППА
		|					ИНАЧЕ _УчетДолгосрочнойАрендыОстатки.ОбъектППА = &ОбъектППА
		|				КОНЕЦ
		|		КОНЕЦ
		|
		|СГРУППИРОВАТЬ ПО
		|	_УчетДолгосрочнойАрендыОстатки.ОбъектППА,
		|	_УчетДолгосрочнойАрендыОстатки.ПериодГрафика,
		|	_УчетДолгосрочнойАрендыОстатки.Договор
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ВТ_Данные.Договор,
		|	ВТ_Данные.ОбъектППА,
		|	ВТ_Данные.Период,
		|	ОКР(ВТ_Данные.АренднаяПлата, 2) КАК АренднаяПлата,
		|	0 КАК НДС,
		|	ОКР(ВТ_Данные.Проценты, 2) КАК Проценты
		|ПОМЕСТИТЬ ВТ_Начисления
		|ИЗ
		|	ВТ_Данные КАК ВТ_Данные
		|ГДЕ
		|	(ОКР(ВТ_Данные.АренднаяПлата, 2) <> 0
		|			ИЛИ ОКР(ВТ_Данные.Проценты, 2) <> 0)
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	Начисления.Договор,
		|	Начисления.Договор.Владелец КАК Контрагент,
		|	Начисления.ОбъектППА,
		//|	Начисления.АренднаяПлата КАК Сумма,
		|	Начисления.НДС,
		|	Начисления.Проценты КАК Сумма,
		|	СписокППА.График,
		|	СписокППА.График.ОтдельныеАктыПоАдресам  как ОтдельныеАктыПоАдресам,
		| 	Значение(Перечисление.СтавкиНДС.БезНДС) как СтавкаНДС
		|ИЗ
		|	ВТ_Начисления КАК Начисления
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_СписокППА КАК СписокППА
		|		ПО ((СписокППА.Дата, СписокППА.ОбъектППА) В
		|				(ВЫБРАТЬ
		|					МАКСИМУМ(СписокППА.Дата),
		|					СписокППА.ОбъектППА
		|				ИЗ
		|					ВТ_СписокППА КАК СписокППА
		|				ГДЕ
		|					СписокППА.ОбъектППА = Начисления.ОбъектППА
		|				СГРУППИРОВАТЬ ПО
		|					СписокППА.ОбъектППА))
		|"; 

	Если СостояниеГрафиковНаДату = Дата(1,1,1) Тогда
		мСостояниеГрафиковНаДату = Дата(2999,1,1)
	Иначе 
		мСостояниеГрафиковНаДату = СостояниеГрафиковНаДату 
	КонецЕсли;
 
	Запрос.Параметры.Вставить("СостояниеГрафиковНаДату", мСостояниеГрафиковНаДату); 
	
	Запрос.Параметры.Вставить("НачалоПериода", НачалоПериода); // <Дата>[01.12.2024 0:00:00]
	Запрос.Параметры.Вставить("КонецПериода", КонецПериода); // <Дата>[01.01.2025 0:00:00]
	Запрос.Параметры.Вставить("Договор", Договор); // <Договор контрагента>[], Справочники.ДоговорыКонтрагентов.ПустаяСсылка();
	Запрос.Параметры.Вставить("Контрагент", Контрагент); // <Контрагент>[КИО (бывший КУГИ)], Справочники.Контрагенты.НайтиПоНаименованию("КИО (бывший КУГИ)");
	Запрос.Параметры.Вставить("ОбъектППА", ОбъектППА); // <Основные средства>[], Справочники.ОсновныеСредства.ПустаяСсылка();
	Запрос.Параметры.Вставить("ДоговорИсключить", ДоговорИсключить); // <Булево>[Нет]
	Запрос.Параметры.Вставить("КонтрагентИсключить", КонтрагентИсключить); // <Булево>[Да]
	Запрос.Параметры.Вставить("ОбъектППАИсключить", ОбъектППАИсключить); // <Булево>[Нет]
	
	Список = Запрос.Выполнить().Выгрузить();
	Сгруппировать(Список);
	
КонецПроцедуры

Процедура ВыбПериодНажатие(Элемент)
	
	НастройкаПериода = Новый НастройкаПериода;
	НастройкаПериода.РедактироватьКакИнтервал = Истина;
	НастройкаПериода.РедактироватьКакПериод = Истина;
	НастройкаПериода.ВариантНастройки = ВариантНастройкиПериода.Период;
	НастройкаПериода.УстановитьПериод(НачалоПериода, ?(КонецПериода='0001-01-01', КонецПериода, КонецДня(КонецПериода)));
	Если НастройкаПериода.Редактировать() Тогда
		НачалоПериода = НастройкаПериода.ПолучитьДатуНачала();
		КонецПериода = НастройкаПериода.ПолучитьДатуОкончания();
	КонецЕсли; 
	
КонецПроцедуры

Процедура Сгруппировать(Тз)
	
	СписокДокументов.Строки.Очистить(); 
	
	Если тз.Количество()=0 Тогда
		Возврат;
	КонецЕсли;
	
	Запрос = Новый Запрос; 
	Запрос.Текст = 
	"ВЫБРАТЬ 
	|	* 
	|	Поместить ВТ 
	|	из &ТЗ как ТЗ;
	|ВЫБРАТЬ
	//|	"""" + ВТ.Контрагент.Код + ""; "" + ВТ.Договор.Код + ""; "" + ВТ.График.Номер " 
	|	"""" + ВТ.Контрагент.Код + ""; "" + ВТ.Договор.Код " 
	+ ?(ВидНачисления = "Арендная плата", 
	"+ Выбор когда ВТ.ОтдельныеАктыПоАдресам = истина тогда ""; "" + вт.ОбъектППА.Код иначе """" Конец", 
	"") 
	+ "	как Номер,
	|	ВТ.Контрагент,
	|	ВТ.Договор,
	|	ВТ.ОбъектППА,
	//|	"" как ДатаС,
	//|	"" как ДатаПо,
	|	ВТ.сумма Как Всего, 
	|	ВТ.сумма Как Сумма,
	|	Вт.НДС как ВсегоНДС,
	|	Вт.НДС как НДС,
	|	ВТ.СтавкаНДС,
	|	ВТ.График как График, 
	//|	"" как НомерСтрокиГрафика,
	//|	ВТ.НомерСтрокиРазбивки, 
	
	|	ДатаВремя(1,1,1,0,0,0) как ДатаДокумента, 
	|	ЗНАЧЕНИЕ(Документ.ПоступлениеТоваровУслуг.пустаяссылка) как НовыйДокумент, 
	|	Выразить("""" как Строка(255))как Сообщение
	|ИЗ
	|	ВТ КАК ВТ
	//| УПОРЯДОЧИТЬ ПО Контрагент, Договор, ОбъектППА
	|Итоги сумма(сумма), сумма(Всего), сумма(НДС), Сумма(ВсегоНДС), количество(ОбъектППА) по Номер";
	
	Запрос.Параметры.Вставить("ТЗ", ТЗ); 
	РезультатЗапроса = Запрос.Выполнить().Выгрузить(ОбходРезультатаЗапроса.ПоГруппировкамСИерархией);
	ОбработатьДерево(РезультатЗапроса);
	СписокДокументов = РезультатЗапроса;
	ЭлементыФормы.СписокДокументов.СоздатьКолонки();  
	
	ЭлементыФормы.СписокДокументов.Колонки["Сумма"].отображатьитогивподвале = истина;
	ЭлементыФормы.СписокДокументов.Колонки["Сумма"].ГоризонтальноеПоложениеВПодвале = ГоризонтальноеПоложение.Право;
	ЭлементыФормы.СписокДокументов.Колонки["Всего"].отображатьитогивподвале = истина;
	ЭлементыФормы.СписокДокументов.Колонки["Всего"].ГоризонтальноеПоложениеВПодвале = ГоризонтальноеПоложение.Право;
	ЭлементыФормы.СписокДокументов.Колонки["НДС"].отображатьитогивподвале = истина;
	ЭлементыФормы.СписокДокументов.Колонки["НДС"].ГоризонтальноеПоложениеВПодвале = ГоризонтальноеПоложение.Право;
	ЭлементыФормы.СписокДокументов.Колонки["ВсегоНДС"].отображатьитогивподвале = истина;
	ЭлементыФормы.СписокДокументов.Колонки["ВсегоНДС"].ГоризонтальноеПоложениеВПодвале = ГоризонтальноеПоложение.Право;
	ЭлементыФормы.СписокДокументов.Колонки["ОбъектППА"].отображатьитогивподвале = истина;
	ЭлементыФормы.СписокДокументов.Колонки["ОбъектППА"].ГоризонтальноеПоложениеВПодвале = ГоризонтальноеПоложение.Право;
	
	Для каждого Колонка Из ЭлементыФормы.СписокДокументов.Колонки Цикл  
		Если Колонка.Имя = "Номер" Тогда
			Колонка.Ширина = 15;
		ИначеЕсли Колонка.Имя = "Контрагент" Тогда 
			Колонка.Ширина = 40;
		ИначеЕсли Колонка.Имя = "Договор" Тогда 
			Колонка.Ширина = 40;
		ИначеЕсли Колонка.Имя = "ОбъектППА" Тогда 
			Колонка.Ширина = 40;
		ИначеЕсли Колонка.Имя = "НовыйДокумент" Тогда 
			Колонка.Ширина = 40;
		ИначеЕсли Колонка.Имя = "НомерСтрокиГрафика" Тогда 
			Колонка.Ширина = 10; 
		ИначеЕсли Колонка.Имя = "СтавкаНДС" Тогда 
			Колонка.Ширина = 15;			
			//ИначеЕсли Колонка.Имя = "НомерСтрокиРазбивки" Тогда 
			//	Колонка.Ширина = 10;
		Иначе
			Колонка.Ширина = 20;
		КонецЕсли;
	КонецЦикла;
	
	ЭлементыФормы.СписокДокументов.Колонки["Контрагент"].ЭлементУправления.КнопкаОткрытия = истина;
	ЭлементыФормы.СписокДокументов.Колонки["Договор"].ЭлементУправления.КнопкаОткрытия = истина;
	ЭлементыФормы.СписокДокументов.Колонки["ОбъектППА"].ЭлементУправления.КнопкаОткрытия = истина;
	ЭлементыФормы.СписокДокументов.Колонки["График"].ЭлементУправления.КнопкаОткрытия = истина;
	ЭлементыФормы.СписокДокументов.Колонки["НовыйДокумент"].ЭлементУправления.КнопкаОткрытия = истина;
	
	СинийЦвет = Новый Цвет(0, 0, 127);
	ЭлементыФормы.СписокДокументов.Колонки["ДатаДокумента"].ЦветТекстаПоля = СинийЦвет;
	
КонецПроцедуры

Процедура ОбработатьДерево(ДЗ) 
	
	Для каждого Строка Из дз.строки Цикл
		
		Строка.Сумма = 0;
		Строка.НДС = 0;
		
		Строка.ДатаДокумента = НачалоДня(КонецПериода);
		//Строка.ДатаС = Дата(1,1,1);
		
		НомерПодстроки = 0;                   
		строка.строки.сортировать("ОбъектППА");
		
		Для каждого подстрока Из строка.строки Цикл
			НомерПодстроки = НомерПодстроки + 1;
			Подстрока.Номер = НомерПодстроки;
			Если НомерПодстроки = 1 Тогда
				Строка.Контрагент = Подстрока.Контрагент;			
				Строка.Договор = Подстрока.Договор;
				Строка.График = Подстрока.График;
				Строка.СтавкаНДС = Подстрока.СтавкаНДС;
			КонецЕсли;
			
			ПодСтрока.Контрагент = Справочники.Контрагенты.ПустаяСсылка();
			ПодСтрока.Договор = Справочники.ДоговорыКонтрагентов.ПустаяСсылка();
			Подстрока.График = Документы._ГрафикДоговораДолгосрочнойАренды.ПустаяСсылка();
			Подстрока.СтавкаНДС = Перечисления.СтавкиНДС.ПустаяСсылка();
			Подстрока.Всего = 0;  
			Подстрока.ВсегоНДС = 0;  
		КонецЦикла;	
		
	КонецЦикла;	
	
	ДЗ.Строки.Сортировать("Контрагент, Договор, ОбъектППА");
	
	НомерДокумента = 0;
	Для каждого Строка Из дз.строки Цикл
		НомерДокумента = НомерДокумента + 1;
		Строка.Номер = НомерДокумента;
		Для каждого ПодСтрока Из Строка.Строки Цикл
			СпособОтраженияРасходов = ПолучитьСпособОтраженияРасходовПоОС(ПодСтрока.ОбъектППА, Строка.ДатаДокумента);
			Если СпособОтраженияРасходов.Проект = null Тогда
			    СтрокаСообщения = СтрШаблон(
					"Не найден проект: Документ [%1], Строка документа [%2], Контрагент [%3], Договор [%4], Объект [%5], сумма [%6]",					
					Строка.Номер,
					ПодСтрока.Номер,
					Строка.Контрагент,
					Строка.Договор,
					Подстрока.ОбъектППА,
					Подстрока.Сумма
					); 
				Сообщить(СтрокаСообщения);
			КонецЕсли;
		КонецЦикла;
	КонецЦикла;	
	
КонецПроцедуры

Процедура СписокДокументовПриВыводеСтроки(Элемент, ОформлениеСтроки, ДанныеСтроки)
	
	Если ДанныеСтроки.Уровень()=1 Тогда
		ЦветПодстроки = Новый Цвет(80, 80, 80);
		ОформлениеСтроки.ЦветТекста = ЦветПодстроки;
		НаклонныйШрифт = новый Шрифт("Arial", 8, Ложь, Истина, Ложь, Ложь); //имя,размер,полужирный,наклонный,подчеркивание,зачеркивание
		ОформлениеСтроки.Шрифт = НаклонныйШрифт ;
	КонецЕсли;
	
КонецПроцедуры

Функция СоздатьДокументПТУПоАренднойПлате(Строка)
	
	НовыйДок = Документы.ПоступлениеТоваровУслуг.СоздатьДокумент();
	НовыйДок.Дата = Строка.ДатаДокумента;
	НовыйДок.ПлатаЗаПравоПользованияПредметамиАренды = Истина;
	НовыйДок.ВидПоступления = перечисления.ВидыПоступленияТоваров.НаСклад;
	НовыйДок.ВидОперации = перечисления.ВидыОперацийПоступлениеТоваровУслуг.ПокупкаКомиссия;
	НовыйДок.Организация = Справочники.Организации.НайтиПоКоду("000000001");
	НовыйДок.Контрагент = Строка.Контрагент;
	НовыйДок.ДоговорКонтрагента = Строка.Договор;
	НовыйДок.ОтражатьВБухгалтерскомУчете = Истина;
	НовыйДок.ОтражатьВНалоговомУчете = Ложь;
	НовыйДок.ОтражатьВУправленческомУчете = Истина;
	НовыйДок.Ответственный = ПараметрыСеанса.ТекущийПользователь;
	НовыйДок.Комментарий = "Начисление арендной платы";
	НовыйДок.СчетУчетаРасчетовСКонтрагентом = ПланыСчетов.Хозрасчетный.НайтиПоКоду("76.07.2");
	НовыйДок.СчетУчетаНДСПоАренднымОбязательствам = ПланыСчетов.Хозрасчетный.НайтиПоКоду("76.07.9");
	НовыйДок.СчетУчетаПроцентовПоАренде = ПланыСчетов.Хозрасчетный.НайтиПоКоду("76.07.5");
	НовыйДок.ВалютаДокумента = Справочники.Валюты.НайтиПоКоду("643");
	НовыйДок.ТипЦен = Справочники.ТипыЦенНоменклатурыКонтрагентов.НайтиПоКоду("00001");
	НовыйДок.КурсВзаиморасчетов = 1;
	НовыйДок.КратностьВзаиморасчетов = 1;
	НовыйДок.Сделка = Строка.График;
	
	мСтавкаНДС = 0;
	
	//Если Строка.СтавкаНДС = Перечисления.СтавкиНДС.БезНДС Тогда
	//	мСтавкаНДС = 0;
	//ИначеЕсли Строка.СтавкаНДС = Перечисления.СтавкиНДС.НДС20 Тогда
	//	мСтавкаНДС = 0.2;
	//ИначеЕсли Строка.СтавкаНДС = Перечисления.СтавкиНДС.НДС5 Тогда
	//	мСтавкаНДС = 0.05;
	//ИначеЕсли Строка.СтавкаНДС = Перечисления.СтавкиНДС.НДС7 Тогда
	//	мСтавкаНДС = 0.07;
	//КонецЕсли;       
	
	мСтавкаНДС = УчетНДС.ПолучитьСтавкуНДС(Строка.СтавкаНДС) / 100;
	
	Если мСтавкаНДС <> 0 Тогда
		НовыйДок.УчитыватьНДС = Истина;
		НовыйДок.СуммаВключаетНДС = Истина;
	КонецЕсли;
	
	Для каждого СтрокаППА Из Строка.Строки Цикл
		НоваяСтрокаТЧ = Новыйдок.Услуги.Добавить();
		
		НоваяСтрокаТЧ.Номенклатура = Справочники.Номенклатура.НайтиПоКоду("00000007676"); 
		НоваяСтрокаТЧ.Количество = 1;
		
		АренднаяПлатаС_НДС = окр(СтрокаППА.Сумма  + СтрокаППА.НДС ,2);
		АренднаяПлатаБезНДС = СтрокаППА.Сумма;   
		СуммаНДС = окр(СтрокаППА.НДС, 2);
		
		НоваяСтрокаТЧ.Цена = АренднаяПлатаС_НДС;
		НоваяСтрокаТЧ.Сумма = АренднаяПлатаС_НДС;
		
		Если мСтавкаНДС <> 0 Тогда
			НоваяСтрокаТч.СуммаНДС = СуммаНДС;
			Если Строка.График.НалоговыйАгент Тогда
				пСтавкаНДС = перечисления.СтавкиНДС.БезНДС;
				Если Строка.СтавкаНДС = перечисления.СтавкиНДС.НДС20 Тогда
					пСтавкаНДС = перечисления.СтавкиНДС.НДС20_120;
				ИначеЕсли Строка.СтавкаНДС = перечисления.СтавкиНДС.НДС22 Тогда					
					пСтавкаНДС = перечисления.СтавкиНДС.НДС22_122;
				ИначеЕсли Строка.СтавкаНДС = перечисления.СтавкиНДС.НДС5 Тогда					
					пСтавкаНДС = перечисления.СтавкиНДС.НДС5_105;
				ИначеЕсли Строка.СтавкаНДС = перечисления.СтавкиНДС.НДС7 Тогда					
					пСтавкаНДС = перечисления.СтавкиНДС.НДС7_107;
				КонецЕсли;
				НоваяСтрокаТч.СтавкаНДС = пСтавкаНДС;
			Иначе
				НоваяСтрокаТч.СтавкаНДС = Строка.СтавкаНДС;
			КонецЕсли;
			НоваяСтрокаТч.СчетУчетаНДС = ПланыСчетов.Хозрасчетный.НайтиПоКоду("19.04");
		Иначе
			НоваяСтрокаТч.СтавкаНДС = перечисления.СтавкиНДС.БезНДС;
		КонецЕсли;
		
		СтруктураПараметровАмортизации =  ПолучитьСпособОтраженияРасходовПоОС(СтрокаППА.ОбъектППА, КонецМесяца(Строка.ДатаДокумента));
		
		НоваяСтрокаТч.ПодразделениеОрганизации = СтруктураПараметровАмортизации.ПодразделениеОрганизации;
		НоваяСтрокаТч.Подразделение = СтруктураПараметровАмортизации.Подразделение;
		НоваяСтрокаТч.Проект = СтруктураПараметровАмортизации.Проект;
		
		НоваяСтрокаТч.СтатьяЗатрат = Справочники.СтатьиЗатрат.НайтиПоКоду("000000118");
		НоваяСтрокаТч.Содержание = "Начисление арендной платы. Инв№ " + СтрокаППА.ОбъектППА.Код;
		НоваяСтрокаТч.ДатаНач = НачалоПериода;
		НоваяСтрокаТч.ДатаКон = КонецПериода;
		НоваяСтрокаТч.СчетЗатрат = ПланыСчетов.Хозрасчетный.НайтиПоКоду("76.07.1");
		НоваяСтрокаТч.СчетЗатратНУ = ПланыСчетов.Налоговый.НайтиПоКоду("20.01.2");
		НоваяСтрокаТч.Субконто1 = Строка.Контрагент;
		НоваяСтрокаТч.Субконто2 = Строка.Договор;
		НоваяСтрокаТч.ОсновноеСредство = СтрокаППА.ОбъектППА;
	КонецЦикла;  
	
	НовыйДок.ПодразделениеОрганизации = СтруктураПараметровАмортизации.ПодразделениеОрганизации;
	НовыйДок.Подразделение = СтруктураПараметровАмортизации.Подразделение;
	НовыйДок.Проект = СтруктураПараметровАмортизации.Проект;
	
	НовыйДок.Записать(РежимЗаписиДокумента.Запись);
	
	Возврат НовыйДок;	
	
КонецФункции      

Функция ПолучитьСпособОтраженияРасходовПоОС(ОсновноеСредство, Период)
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	ОсновныеСредства.Ссылка КАК ОсновноеСредство,
	|	ОсновныеСредства.ГруппаОС.Ссылка КАК ГруппаОС,
	|	ОсновныеСредства.ТипОС,
	|	МестонахождениеОСБухгалтерскийУчетСрезПоследних._АдресМестонахождения КАК Адрес,
	|	СпособыОтраженияРасходовПоАмортизацииСпособы.СтатьяЗатрат,
	|	СпособыОтраженияРасходовПоАмортизацииСпособы.НоменклатурнаяГруппа,
	|	СпособыОтраженияРасходовПоАмортизацииСпособы.Подразделение,
	|	СпособыОтраженияРасходовПоАмортизацииСпособы.ПодразделениеОрганизации,
	|	СпособыОтраженияРасходовПоАмортизацииСпособы.СчетЗатрат,
	|	Проекты.Ссылка КАК Проект
	|ИЗ
	|	Справочник.ОсновныеСредства КАК ОсновныеСредства
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.МестонахождениеОСБухгалтерскийУчет.СрезПоследних(&Период, ) КАК МестонахождениеОСБухгалтерскийУчетСрезПоследних
	|		ПО (МестонахождениеОСБухгалтерскийУчетСрезПоследних.ОсновноеСредство = ОсновныеСредства.Ссылка)
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.СпособыОтраженияРасходовПоАмортизацииОСБухгалтерскийУчет.СрезПоследних(&Период, ) КАК СпособыОтраженияРасходовПоАмортизацииОСБухгалтерскийУчетСрезПоследних
	|			ЛЕВОЕ СОЕДИНЕНИЕ Справочник.СпособыОтраженияРасходовПоАмортизации.Способы КАК СпособыОтраженияРасходовПоАмортизацииСпособы
	|			ПО СпособыОтраженияРасходовПоАмортизацииОСБухгалтерскийУчетСрезПоследних.СпособыОтраженияРасходовПоАмортизации = СпособыОтраженияРасходовПоАмортизацииСпособы.Ссылка
	|			ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Проекты КАК Проекты
	|			ПО (СпособыОтраженияРасходовПоАмортизацииСпособы.ПодразделениеОрганизации.КодПоОКТМО = Проекты.Код)
	|		ПО (СпособыОтраженияРасходовПоАмортизацииОСБухгалтерскийУчетСрезПоследних.ОсновноеСредство = ОсновныеСредства.Ссылка)
	|ГДЕ
	|	ОсновныеСредства.Ссылка = &ОсновноеСредство";
	
	Запрос.УстановитьПараметр ("ОсновноеСредство", ОсновноеСредство);
	Запрос.УстановитьПараметр ("Период", Период);
	
	РезультатЗапроса = Запрос.Выполнить();
	
	ВыборкаДетальныеЗаписи = РезультатЗапроса.Выбрать();
	
	Пока ВыборкаДетальныеЗаписи.Следующий() Цикл
		Структура = Новый Структура;
		Структура.Вставить("ОсновноеСредство", ВыборкаДетальныеЗаписи.ОсновноеСредство);
		Структура.Вставить("ГруппаОС", ВыборкаДетальныеЗаписи.ГруппаОС);
		Структура.Вставить("ТипОС", ВыборкаДетальныеЗаписи.ТипОС);
		Структура.Вставить("Адрес", ВыборкаДетальныеЗаписи.Адрес);
		Структура.Вставить("СтатьяЗатрат", ВыборкаДетальныеЗаписи.СтатьяЗатрат);
		Структура.Вставить("НоменклатурнаяГруппа", ВыборкаДетальныеЗаписи.НоменклатурнаяГруппа);
		Структура.Вставить("Подразделение", ВыборкаДетальныеЗаписи.Подразделение);
		Структура.Вставить("ПодразделениеОрганизации", ВыборкаДетальныеЗаписи.ПодразделениеОрганизации);
		Структура.Вставить("Проект", ВыборкаДетальныеЗаписи.Проект);
		Структура.Вставить("СчетЗатрат", ВыборкаДетальныеЗаписи.СчетЗатрат);
	КонецЦикла;
	
	Возврат Структура;
	
КонецФункции // ПолучитьСпособОтраженияРасходовПоОС()

Процедура ПередЗакрытием(Отказ, СтандартнаяОбработка)
	
	Если СписокДокументов.Строки.Количество()>0 и Вопрос("Закрыть обработку?", РежимДиалогаВопрос.ДаНет) = КодВозвратаДиалога.Нет Тогда
		Отказ = Истина;	
	КонецЕсли;	
	
КонецПроцедуры

Функция СоздатьДокументПТУПоПроцентам(Строка)
	
	
	НовыйДок = Документы.ПоступлениеТоваровУслуг.СоздатьДокумент();
	НовыйДок.Дата = Строка.ДатаДокумента;
	
	НовыйДок.ВидПоступления = перечисления.ВидыПоступленияТоваров.НаСклад;
	НовыйДок.ВидОперации = перечисления.ВидыОперацийПоступлениеТоваровУслуг.ПокупкаКомиссия;
	НовыйДок.Организация = Справочники.Организации.НайтиПоКоду("000000001");
	НовыйДок.Контрагент = Строка.Контрагент;
	НовыйДок.ДоговорКонтрагента = Строка.Договор;
	НовыйДок.ОтражатьВБухгалтерскомУчете = Истина;
	НовыйДок.ОтражатьВНалоговомУчете = Истина;
	НовыйДок.ОтражатьВУправленческомУчете = Истина;
	НовыйДок.Ответственный = ПараметрыСеанса.ТекущийПользователь;
	НовыйДок.Комментарий = "Проценты по арендной плате";
	НовыйДок.СчетУчетаРасчетовСКонтрагентом = ПланыСчетов.Хозрасчетный.НайтиПоКоду("76.07.5"); 
	НовыйДок.СчетУчетаРасчетовПоАвансам = ПланыСчетов.Хозрасчетный.НайтиПоКоду("76.07.5");
	НовыйДок.ВалютаДокумента = Справочники.Валюты.НайтиПоКоду("643");
	НовыйДок.ТипЦен = Справочники.ТипыЦенНоменклатурыКонтрагентов.НайтиПоКоду("00001");
	НовыйДок.КурсВзаиморасчетов = 1;
	НовыйДок.КратностьВзаиморасчетов = 1;
	НовыйДок.Сделка = Строка.График;
	
	Для каждого СтрокаППА Из Строка.Строки Цикл
		СтруктураПараметровАмортизации =  ПолучитьСпособОтраженияРасходовПоОС(СтрокаППА.ОбъектППА, КонецМесяца(Строка.ДатаДокумента));
		НоваяСтрокаТЧ = Новыйдок.Услуги.Добавить();
		НоваяСтрокаТЧ.Номенклатура = Справочники.Номенклатура.НайтиПоКоду("00000007676"); 
		НоваяСтрокаТЧ.Количество = 1;
		НоваяСтрокаТЧ.Цена = СтрокаППА.Сумма;
		НоваяСтрокаТЧ.Сумма = СтрокаППА.Сумма;
		НоваяСтрокаТч.Подразделение = СтруктураПараметровАмортизации.Подразделение;
		НоваяСтрокаТч.Проект = СтруктураПараметровАмортизации.Проект;
		НоваяСтрокаТч.СтатьяЗатрат = Справочники.СтатьиЗатрат.НайтиПоКоду("990000024");
		НоваяСтрокаТч.Содержание = "Проценты по аренде. Инв№ " + СтрокаППА.ОбъектППА.Код;
		НоваяСтрокаТч.ДатаНач = НачалоПериода;
		НоваяСтрокаТч.ДатаКон = КонецПериода;
		НоваяСтрокаТч.СчетЗатрат = ПланыСчетов.Хозрасчетный.НайтиПоКоду("91.02.1");
		НоваяСтрокаТч.СчетЗатратНУ = ПланыСчетов.Налоговый.НайтиПоКоду("91.02.7");
		
		ПодразделениеОрганизации91 = Строка.График.СоставППА.Найти(СтрокаППА.ОбъектППА, "ОбъектППА").ПодразделениеОрганизации91;
		СтатьяПрочихДоходовИРасходов = Строка.График.СоставППА.Найти(СтрокаППА.ОбъектППА, "ОбъектППА").СтатьяПрочихДоходовИРасходов;
		
		НоваяСтрокаТч.ПодразделениеОрганизации = ПодразделениеОрганизации91;
		НоваяСтрокаТч.Субконто1 = СтатьяПрочихДоходовИРасходов;
		НоваяСтрокаТч.СубконтоНУ1 = СтатьяПрочихДоходовИРасходов;
		НоваяСтрокаТч.Субконто2 = ПодразделениеОрганизации91;
	КонецЦикла;  
	
	НовыйДок.Записать(РежимЗаписиДокумента.Запись);
	
	Возврат НовыйДок;	
	
КонецФункции      

Процедура ДействияФормыПровестиСозданныеДокументы(Кнопка)
	
	Если СписокДокументов.Строки.Количество() = 0 или Вопрос("Запустить проведение?", РежимДиалогаВопрос.ДаНет) = КодВозвратаДиалога.Нет Тогда 
		Возврат;
		Отказ = Истина;	
	КонецЕсли;
	
	Для каждого Строка Из СписокДокументов.Строки Цикл
		
		ЭлементыФормы.СписокДокументов.ТекущаяСтрока = Строка;
		
		Если НЕ ЗначениеЗаполнено(Строка.новыйДокумент) Тогда
			Продолжить;
		КонецЕсли; 
		
		Если Строка.НовыйДокумент.Проведен Тогда
			Продолжить;
		КонецЕсли; 
		
		Попытка
			Док = Строка.НовыйДокумент.ПолучитьОбъект();
			Док.Записать(РежимЗаписиДокумента.Проведение);
			Строка.Сообщение = "Проведен";
		Исключение
			ТекстСообщения = СтрШаблон("Ошибка проведения документа: строка №%1 от %2, %3, %4." + ОписаниеОшибки(), 
			Строка.Номер, 
			Строка.ДатаДокумента, 
			Строка.Контрагент, 
			Строка.Договор);
			Строка.Сообщение = ТекстСообщения;												
			Сообщить(ТекстСообщения);
		КонецПопытки;		
		ЭтаФорма.Обновить();
		
	КонецЦикла;
	
	Предупреждение("Завершено");
	
КонецПроцедуры
